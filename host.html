<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Delta-X Pure Screen Streamer</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; text-align: center; }
        video { width: 90%; border: 2px solid #0f0; border-radius: 10px; background: #111; margin-top: 20px; }
        button { padding: 15px 30px; background: #0f0; border: none; cursor: pointer; font-weight: bold; border-radius: 8px; margin-top: 10px; }
        #status { color: #ff0; margin-top: 10px; }
    </style>
</head>
<body>
    <h2 style="color:#0f0">SYSTEM: CLOUD STREAMING</h2>
    <video id="remoteVideo" autoplay playsinline muted></video>
    <br>
    <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø¨Ø« Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</button>
    <div id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„...</div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø¨ØªØ§Ø¹ØªÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyCpeOSPCzow5Iv472BUEmKvYVt63cIsi-E",
            authDomain: "delta-x-b7b69.firebaseapp.com",
            databaseURL: "https://delta-x-b7b69-default-rtdb.firebaseio.com",
            projectId: "delta-x-b7b69",
            storageBucket: "delta-x-b7b69.firebasestorage.app",
            messagingSenderId: "758371825673",
            appId: "1:758371825673:web:59fcf8401f5ae58bf9a0d8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let peerConnection;
        const servers = { iceServers: [{ urls: 'stun:stun1.l.google.com:19302' }] };

        document.getElementById('startBtn').onclick = async () => {
            try {
                // Ø·Ù„Ø¨ Ø¨Ø« Ø§Ù„Ø´Ø§Ø´Ø© (Ù‡ÙŠØ±ÙˆØ­ Ù„Ù„Ø¬Ø§ÙØ§ ÙŠÙØªØ­ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯)
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                document.getElementById('remoteVideo').srcObject = stream;
                document.getElementById('status').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø« Ø¹Ø¨Ø± WebRTC...";

                peerConnection = new RTCPeerConnection(servers);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ù€ WebRTC
                stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));

                peerConnection.onicecandidate = e => {
                    if (e.candidate) db.ref('rooms/1/hostCandidates').push(e.candidate.toJSON());
                };

                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                await db.ref('rooms/1').set({ offer: { type: offer.type, sdp: offer.sdp } });

                db.ref('rooms/1/answer').on('value', async (snap) => {
                    if (snap.val() && !peerConnection.currentRemoteDescription) {
                        await peerConnection.setRemoteDescription(new RTCIceDescription(snap.val()));
                        document.getElementById('status').innerText = "ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­! ðŸ“¡";
                    }
                });
            } catch (err) {
                document.getElementById('status').innerText = "Ø®Ø·Ø£: " + err.message;
            }
        };
    </script>
</body>
</html>
